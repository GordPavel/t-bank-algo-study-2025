–î–ª—è —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏, –≥–¥–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞–π—Ç–∏ –æ—Ç—Ä–µ–∑–æ–∫ –º–∞—Å—Å–∏–≤–∞ —Å **–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è (—Å—É–º–º–∞ √ó –º–∏–Ω–∏–º—É–º)**, –º–æ–∂–Ω–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è **–ø–æ–¥—Ö–æ–¥–æ–º –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–æ–Ω–æ—Ç–æ–Ω–Ω–æ–≥–æ —Å—Ç–µ–∫–∞**, –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–º –∑–∞–¥–∞—á–µ –ø–æ–∏—Å–∫–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø–ª–æ—â–∞–¥–∏ –≤ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º–µ.

---

## üß† –ò–¥–µ—è —Ä–µ—à–µ–Ω–∏—è

–ó–∞–¥–∞—á–∞:  
–ù–∞–π—Ç–∏ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –ø–æ–¥–º–∞—Å—Å–∏–≤ `a[i..j]`, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–µ `(sum(a[i..j]) * min(a[i..j]))` –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ.

### üîç –ö–ª—é—á–µ–≤–∞—è –∏–¥–µ—è:
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ `a[i]` –±—É–¥–µ–º —Å—á–∏—Ç–∞—Ç—å –µ–≥–æ **–º–∏–Ω–∏–º—É–º–æ–º** –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä–æ–º –æ—Ç—Ä–µ–∑–∫–µ `[l, r]`.
- –í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —ç—Ç–æ–≥–æ –æ—Ç—Ä–µ–∑–∫–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **–Ω–µ –º–µ–Ω—å—à–µ a[i]**.
- –¢–æ–≥–¥–∞ –º—ã –º–æ–∂–µ–º —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ—Ç—Ä–µ–∑–∫–∏, –≥–¥–µ `a[i]` ‚Äî —ç—Ç–æ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç.
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∞–∫–æ–≥–æ –æ—Ç—Ä–µ–∑–∫–∞ –≤—ã—á–∏—Å–ª—è–µ–º:
  ```
  sum * a[i]
  ```
  –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –º–∞–∫—Å–∏–º—É–º.

---

## ‚öôÔ∏è –®–∞–≥–∏ —Ä–µ—à–µ–Ω–∏—è:

1. **–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ñ–∏–∫—Å–Ω—ã—Ö —Å—É–º–º**:
    - –ß—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –≤—ã—á–∏—Å–ª—è—Ç—å —Å—É–º–º—É –ª—é–±–æ–≥–æ –ø–æ–¥–º–∞—Å—Å–∏–≤–∞, —Å—Ç—Ä–æ–∏–º –º–∞—Å—Å–∏–≤ –ø—Ä–µ—Ñ–∏–∫—Å–Ω—ã—Ö —Å—É–º–º.

2. **–î–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –Ω–∞—Ö–æ–¥–∏–º –¥–∏–∞–ø–∞–∑–æ–Ω `[left, right]`, –≥–¥–µ –æ–Ω —è–≤–ª—è–µ—Ç—Å—è –º–∏–Ω–∏–º—É–º–æ–º**:
    - –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–≤–∞ –ø—Ä–æ—Ö–æ–¥–∞:
        - `nextSmallerToLeft(i)` ‚Äì –∏–Ω–¥–µ–∫—Å –±–ª–∏–∂–∞–π—à–µ–≥–æ –º–µ–Ω—å—à–µ–≥–æ —Å–ª–µ–≤–∞
        - `nextSmallerToRight(i)` ‚Äì –∏–Ω–¥–µ–∫—Å –±–ª–∏–∂–∞–π—à–µ–≥–æ –º–µ–Ω—å—à–µ–≥–æ —Å–ø—Ä–∞–≤–∞
    - –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, —á—Ç–æ `a[i]` ‚Äî –º–∏–Ω–∏–º—É–º –¥–ª—è –≤—Å–µ—Ö –ø–æ–¥–º–∞—Å—Å–∏–≤–æ–≤, –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö—Å—è –ø–æ—Å–ª–µ `left+1` –∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—â–∏—Ö—Å—è –ø–µ—Ä–µ–¥ `right-1`.

3. **–í—ã—á–∏—Å–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –ø–æ–¥–º–∞—Å—Å–∏–≤–∞ `[left+1, right-1]`**:
    - –°—É–º–º–∞ –ø–æ–¥–º–∞—Å—Å–∏–≤–∞: `prefix[right] - prefix[left]`
    - –ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ: `sum * a[i]`
    - –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π –º–∞–∫—Å–∏–º—É–º.

---

## ‚úÖ –ü—Ä–∏–º–µ—Ä

```java
–í—Ö–æ–¥: a = [3, 1, 2, 4]
```

–í–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ–¥–º–∞—Å—Å–∏–≤—ã –∏ –∑–Ω–∞—á–µ–Ω–∏—è:
- [3] ‚Üí 3√ó3 = 9
- [1] ‚Üí 1√ó1 = 1
- [2] ‚Üí 2√ó2 = 4
- [4] ‚Üí 4√ó4 = 16
- [3,1] ‚Üí (4)*1 = 4
- [1,2,4] ‚Üí (7)*1 = 7
- [3,1,2,4] ‚Üí (10)*1 = 10

–ú–∞–∫—Å–∏–º—É–º: **[4] ‚Üí 16**

---

## üíª –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ Java

```java
import java.util.*;

public class MaxProductSumMin {
    public static int maxProduct(int[] a) {
        int n = a.length;
        int[] prefix = new int[n + 1];
        
        // –ü—Ä–µ—Ñ–∏–∫—Å–Ω—ã–µ —Å—É–º–º—ã
        for (int i = 0; i < n; i++) {
            prefix[i + 1] = prefix[i] + a[i];
        }

        // –ò–Ω–¥–µ–∫—Å—ã –±–ª–∏–∂–∞–π—à–∏—Ö –º–µ–Ω—å—à–∏—Ö —Å–ª–µ–≤–∞ –∏ —Å–ø—Ä–∞–≤–∞
        int[] left = new int[n];
        int[] right = new int[n];

        Arrays.fill(left, -1);
        Arrays.fill(right, n);

        Deque<Integer> stack = new ArrayDeque<>();

        // –ë–ª–∏–∂–∞–π—à–∏–µ –º–µ–Ω—å—à–∏–µ —Å–ª–µ–≤–∞
        for (int i = 0; i < n; i++) {
            while (!stack.isEmpty() && a[stack.peek()] >= a[i]) {
                stack.pop();
            }
            if (!stack.isEmpty()) {
                left[i] = stack.peek();
            }
            stack.push(i);
        }

        stack.clear();

        // –ë–ª–∏–∂–∞–π—à–∏–µ –º–µ–Ω—å—à–∏–µ —Å–ø—Ä–∞–≤–∞
        for (int i = n - 1; i >= 0; i--) {
            while (!stack.isEmpty() && a[stack.peek()] >= a[i]) {
                stack.pop();
            }
            if (!stack.isEmpty()) {
                right[i] = stack.peek();
            }
            stack.push(i);
        }

        int maxResult = 0;

        for (int i = 0; i < n; i++) {
            int l = left[i];
            int r = right[i];

            // –ü–æ–¥–º–∞—Å—Å–∏–≤ [l+1 ... r-1], –≥–¥–µ a[i] - –º–∏–Ω–∏–º—É–º
            int sum = prefix[r] - prefix[l + 1];
            int product = sum * a[i];

            maxResult = Math.max(maxResult, product);
        }

        return maxResult;
    }

    public static void main(String[] args) {
        int[] a = {3, 1, 2, 4};
        System.out.println("–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (—Å—É–º–º–∞ √ó –º–∏–Ω–∏–º—É–º): " + maxProduct(a));
    }
}
```

---

## üìà –ê–Ω–∞–ª–∏–∑ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|--------|----------|
| –í—Ä–µ–º–µ–Ω–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å | O(n) ‚Äî –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–æ–µ —á–∏—Å–ª–æ —Ä–∞–∑ |
| –ü–∞–º—è—Ç—å | O(n) ‚Äî –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–∞—Å—Å–∏–≤—ã `left`, `right`, `prefix` |

---

## üß™ –î—Ä—É–≥–æ–π –ø—Ä–∏–º–µ—Ä

```java
int[] a = {6, 2, 5, 4, 5, 1, 6};
System.out.println(maxProduct(a)); // –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: 18
// –ü–æ–¥–º–∞—Å—Å–∏–≤ [5, 4, 5], —Å—É–º–º–∞ = 14, –º–∏–Ω–∏–º—É–º = 4 ‚Üí 14 * 4 = 56
// –ù–æ –µ—Å—Ç—å –ª—É—á—à–µ: [5, 4, 5, 1, 6] ‚Üí —Å—É–º–º–∞ = 21, –º–∏–Ω–∏–º—É–º = 1 ‚Üí 21*1=21
// –ê –µ—â—ë –ª—É—á—à–µ: [2, 5, 4, 5] ‚Üí —Å—É–º–º–∞ = 16, –º–∏–Ω–∏–º—É–º = 2 ‚Üí 16*2=32
// –õ—É—á—à–∏–π: [5, 4, 5] ‚Üí 14 * 4 = 56
```

---

## ‚úÖ –í—ã–≤–æ–¥

–≠—Ç–æ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–µ—à–∞–µ—Ç –∑–∞–¥–∞—á—É –∑–∞ –ª–∏–Ω–µ–π–Ω–æ–µ –≤—Ä–µ–º—è –±–ª–∞–≥–æ–¥–∞—Ä—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –º–æ–Ω–æ—Ç–æ–Ω–Ω–æ–≥–æ —Å—Ç–µ–∫–∞ –∏ –ø—Ä–µ—Ñ–∏–∫—Å–Ω—ã—Ö —Å—É–º–º. –û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–∞–∂–µ –¥–ª—è –±–æ–ª—å—à–∏—Ö –º–∞—Å—Å–∏–≤–æ–≤ –∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.